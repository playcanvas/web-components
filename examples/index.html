<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
        <title>PlayCanvas Web Components - Examples</title>
        <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
        <link rel="stylesheet" href="css/browser.css">
    </head>
    <body>
        <div class="sidebar">
            <div class="header">
                <img src="img/playcanvas.png" alt="PlayCanvas Logo" class="logo">
                <div>
                    <h2>PlayCanvas<br>Web Components</h2>
                </div>
            </div>
            <div id="example-list"></div>
        </div>
        <div class="main">
            <iframe id="example-frame" allow="fullscreen; xr-spatial-tracking;"></iframe>
        </div>
        <div id="qr-modal" style="display: none;">
            <div class="qr-modal-content">
                <div id="qr-code"></div>
                <p>Scan to view on mobile</p>
            </div>
        </div>
        <script type="module">
            import { examples } from './js/examples.mjs';
            import { showQRCode } from './js/qr-code.mjs';
            import { setupNavigation } from './js/navigation.mjs';
            import { loadExample } from './js/example-loader.mjs';

            // Get DOM elements
            const frame = document.getElementById('example-frame');
            const exampleList = document.getElementById('example-list');

            // Setup navigation
            const exampleLoader = loadExample(frame);
            const { updateURL } = setupNavigation(exampleLoader);

            // Create example links
            examples.forEach(example => {
                const link = document.createElement('a');
                link.href = '#' + example.path;
                link.className = 'example-link';
                
                const nameSpan = document.createElement('span');
                nameSpan.textContent = example.name;
                link.appendChild(nameSpan);

                const buttonContainer = document.createElement('div');
                buttonContainer.style.display = 'flex';
                buttonContainer.style.gap = '4px';

                const qrButton = document.createElement('button');
                qrButton.className = 'qr-button';
                qrButton.innerHTML = 'ðŸ“±';
                qrButton.title = 'View QR code for mobile';
                qrButton.onclick = (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    showQRCode(example.path, qrcode);
                };
                buttonContainer.appendChild(qrButton);

                const openInNew = document.createElement('a');
                openInNew.href = example.path;
                openInNew.target = '_blank';
                openInNew.className = 'open-in-new';
                openInNew.innerHTML = 'â†—ï¸';
                openInNew.title = 'Open in new tab';
                openInNew.onclick = (e) => e.stopPropagation();
                buttonContainer.appendChild(openInNew);

                link.appendChild(buttonContainer);

                link.onclick = (e) => {
                    if (e.target !== openInNew) {
                        e.preventDefault();
                        exampleLoader(example.path);
                        updateURL(example.path);
                        document.querySelectorAll('.example-link')
                            .forEach(l => l.classList.remove('active'));
                        link.classList.add('active');
                    }
                };
                
                exampleList.appendChild(link);
            });

            // Load initial example
            if (examples.length > 0) {
                const hash = window.location.hash.slice(1);
                if (hash && examples.some(ex => ex.path === hash)) {
                    exampleLoader(hash);
                    document.querySelector(`a[href="#${hash}"]`)?.classList.add('active');
                } else {
                    exampleLoader(examples[0].path);
                    updateURL(examples[0].path);
                    exampleList.firstChild?.classList.add('active');
                }
            }
        </script>
    </body>
</html>
